<!doctype html>
<html lang="en-US">
  <head>
    <title>Making my first Ruby gem</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta
      name="description"
      content="An experience report of writing and publishing a Ruby gem"
    />
    <meta name="robots" content="index, follow" />

    <link
      rel="canonical"
      href="https://jew.ski/article/making-my-first-ruby-gem/index.html"
    />

    <link rel="icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" href="/logo192.png" />

    <meta name="theme-color" content="#178bfb" />

    <meta property="og:title" content="Making my first Ruby gem" />
    <meta property="og:type" content="article" />
    <meta property="og:site_name" content="Chris Andrejewski" />
    <meta
      property="og:url"
      content="/article/making-my-first-ruby-gem/index.html"
    />

    <meta property="twitter:card" content="summary" />
    <meta name="twitter:site" content="compooter" />
    <meta name="twitter:title" content="Making my first Ruby gem" />
    <meta
      name="twitter:description"
      content="An experience report of writing and publishing a Ruby gem"
    />

    <link rel="stylesheet" href="/stylesheet/highlight-atom-one.css" />
    <style data-styled="true" data-styled-version="6.1.17">
      .bctNTf {
        color: rgb(6, 90, 163);
      } /*!sc*/
      @media (prefers-color-scheme: dark) {
        .bctNTf {
          color: #5eb6ff;
        }
      } /*!sc*/
      data-styled.g1[id='sc-Qotzb'] {
        content: 'bctNTf,';
      } /*!sc*/
      .hxbvAH {
        padding-bottom: 4rem;
      } /*!sc*/
      data-styled.g2[id='sc-fYsHOw'] {
        content: 'hxbvAH,';
      } /*!sc*/
      .debzsy {
        background-color: #fff;
      } /*!sc*/
      @media (prefers-color-scheme: dark) {
        .debzsy {
          background-color: #16202e;
        }
      } /*!sc*/
      data-styled.g3[id='sc-dKREkF'] {
        content: 'debzsy,';
      } /*!sc*/
      .dtgyPg {
        padding: 0px 1rem;
        max-width: 720px;
        margin: 0px auto;
      } /*!sc*/
      data-styled.g4[id='sc-fWnslK'] {
        content: 'dtgyPg,';
      } /*!sc*/
      .eyyqef {
        margin: 15px 0em;
      } /*!sc*/
      .eyyqef:first-child {
        margin-top: 0px;
      } /*!sc*/
      .eyyqef:last-child {
        margin-bottom: 0px;
      } /*!sc*/
      data-styled.g5[id='sc-dIMoHT'] {
        content: 'eyyqef,';
      } /*!sc*/
      .hkwuxz {
        padding-top: 3rem;
        margin-bottom: 3rem;
      } /*!sc*/
      data-styled.g6[id='sc-iQQCXo'] {
        content: 'hkwuxz,';
      } /*!sc*/
      .foDfFI {
        font-size: 3rem;
        margin: 0px;
      } /*!sc*/
      @media (max-width: 720px) {
        .foDfFI {
          font-size: 1.8rem;
        }
      } /*!sc*/
      data-styled.g7[id='sc-gDpztx'] {
        content: 'foDfFI,';
      } /*!sc*/
      .iwpgrf {
        margin: 0;
        line-height: 1.5rem;
      } /*!sc*/
      @media (prefers-color-scheme: dark) {
        .iwpgrf {
          color: #dbe0e7;
        }
      } /*!sc*/
      data-styled.g8[id='sc-kpOvIu'] {
        content: 'iwpgrf,';
      } /*!sc*/
      .leFObR {
        display: inline-block;
        font-size: 0.9rem;
        line-height: 1rem;
        background-color: #dcefff;
        color: #151515;
        border-radius: 3px;
        padding: 0.25rem 0.5rem;
        margin: 0.25rem 0.5rem 0.25rem 0;
        text-decoration: none;
        white-space: nowrap;
      } /*!sc*/
      .leFObR:hover {
        text-decoration: underline;
      } /*!sc*/
      @media (prefers-color-scheme: dark) {
        .leFObR {
          background-color: #2f3d4e;
          color: #c8d2e0;
        }
      } /*!sc*/
      data-styled.g9[id='sc-icnseD'] {
        content: 'leFObR,';
      } /*!sc*/
      .iLjxYJ {
        color: inherit;
        text-decoration: none;
      } /*!sc*/
      .iLjxYJ:hover span {
        text-decoration: underline;
      } /*!sc*/
      .iLjxYJ:hover:after {
        opacity: 1;
      } /*!sc*/
      .iLjxYJ:after {
        content: 'ðŸ”—';
        padding: 0 0.5rem;
        font-size: 1rem;
        opacity: 0.25;
      } /*!sc*/
      data-styled.g10[id='sc-jMsorb'] {
        content: 'iLjxYJ,';
      } /*!sc*/
      .hskrPk {
        padding: 1rem;
        margin: 3rem 0;
        background-color: #eef8ff;
        color: #4a8dc8;
      } /*!sc*/
      @media (prefers-color-scheme: dark) {
        .hskrPk {
          background-color: #2a3d55;
          color: #95afd1;
        }
      } /*!sc*/
      .hskrPk label {
        text-transform: uppercase;
        font-weight: bold;
        font-size: 0.85rem;
        color: #08273f;
      } /*!sc*/
      @media (prefers-color-scheme: dark) {
        .hskrPk label {
          color: #dde0e3;
        }
      } /*!sc*/
      .hskrPk .sc-kpOvIu {
        color: #153248;
      } /*!sc*/
      @media (prefers-color-scheme: dark) {
        .hskrPk .sc-kpOvIu {
          color: #d0e4ff;
        }
      } /*!sc*/
      .hskrPk ul {
        margin: 0.5rem 0;
        padding: 0;
        padding-left: 1rem;
      } /*!sc*/
      .hskrPk a {
        color: rgb(6, 90, 163);
      } /*!sc*/
      @media (prefers-color-scheme: dark) {
        .hskrPk a {
          color: #5eb6ff;
        }
      } /*!sc*/
      .hskrPk a code {
        font-family: Monaco, monospace;
        font-size: 0.9rem;
        padding: 0 0.25rem;
        border-radius: 3px;
        background-color: #b9dbf5;
      } /*!sc*/
      @media (prefers-color-scheme: dark) {
        .hskrPk a code {
          background-color: #354e6d;
        }
      } /*!sc*/
      data-styled.g11[id='sc-cXawGu'] {
        content: 'hskrPk,';
      } /*!sc*/
      * {
        box-sizing: border-box;
      } /*!sc*/
      body {
        margin: 0px;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica,
          Arial, sans-serif, 'Apple Color Emoji', 'Segoe UI Emoji',
          'Segoe UI Symbol';
        background-color: #eff7fd;
        color: #000;
      } /*!sc*/
      @media (prefers-color-scheme: dark) {
        body {
          background-color: #0d1117;
          color: #fff;
        }
      } /*!sc*/
      data-styled.g12[id='sc-global-kFwHxP1'] {
        content: 'sc-global-kFwHxP1,';
      } /*!sc*/
      .jjMGJZ {
        display: flex;
        justify-content: space-between;
        align-items: center;
      } /*!sc*/
      .jjMGJZ h1 {
        font-size: 1.5rem;
        padding: 1rem 0px;
        margin: 0;
      } /*!sc*/
      .jjMGJZ h1 a {
        text-decoration: none;
        color: inherit;
      } /*!sc*/
      .jjMGJZ h1 a:hover {
        text-decoration: underline;
      } /*!sc*/
      @media (max-width: 720px) {
        .jjMGJZ .sc-jJAtPt {
          display: none;
        }
      } /*!sc*/
      data-styled.g14[id='sc-cUiCeM'] {
        content: 'jjMGJZ,';
      } /*!sc*/
      .gdJarr {
        border-top: 2px solid #d7d7d7;
        margin: 4rem 0;
        padding-top: 4rem;
      } /*!sc*/
      @media (prefers-color-scheme: dark) {
        .gdJarr {
          border-color: #4c545e;
        }
      } /*!sc*/
      data-styled.g54[id='sc-gDVcuj'] {
        content: 'gdJarr,';
      } /*!sc*/
      .hpaLEJ h1 > a,
      .hpaLEJ h2 > a,
      .hpaLEJ h3 > a,
      .hpaLEJ h4 > a,
      .hpaLEJ h5 > a,
      .hpaLEJ h6 > a {
        color: inherit;
        text-decoration: none;
      } /*!sc*/
      .hpaLEJ h1 > a:hover,
      .hpaLEJ h2 > a:hover,
      .hpaLEJ h3 > a:hover,
      .hpaLEJ h4 > a:hover,
      .hpaLEJ h5 > a:hover,
      .hpaLEJ h6 > a:hover {
        text-decoration: underline;
      } /*!sc*/
      .hpaLEJ p,
      .hpaLEJ li {
        line-height: 1.5rem;
      } /*!sc*/
      @media (prefers-color-scheme: dark) {
        .hpaLEJ p,
        .hpaLEJ li {
          color: #dbe0e7;
        }
      } /*!sc*/
      .hpaLEJ a {
        color: rgb(6, 90, 163);
      } /*!sc*/
      @media (prefers-color-scheme: dark) {
        .hpaLEJ a {
          color: #5eb6ff;
        }
      } /*!sc*/
      .hpaLEJ ul {
        padding-left: 1rem;
      } /*!sc*/
      .hpaLEJ code {
        font-family: Monaco, monospace;
      } /*!sc*/
      .hpaLEJ h1 code,
      .hpaLEJ h2 code,
      .hpaLEJ h3 code,
      .hpaLEJ h4 code,
      .hpaLEJ h5 code,
      .hpaLEJ h6 code,
      .hpaLEJ li code,
      .hpaLEJ p code {
        font-size: 0.9em;
        padding: 0 0.25em;
        border-radius: 3px;
        background-color: #eff7fd;
      } /*!sc*/
      @media (prefers-color-scheme: dark) {
        .hpaLEJ h1 code,
        .hpaLEJ h2 code,
        .hpaLEJ h3 code,
        .hpaLEJ h4 code,
        .hpaLEJ h5 code,
        .hpaLEJ h6 code,
        .hpaLEJ li code,
        .hpaLEJ p code {
          background-color: #2b3644;
        }
      } /*!sc*/
      .hpaLEJ pre {
        background-color: #eff7fd;
        padding: 0.5rem 0.75rem;
        overflow-x: scroll;
      } /*!sc*/
      @media (prefers-color-scheme: dark) {
        .hpaLEJ pre {
          background-color: #2b3645;
        }
      } /*!sc*/
      .hpaLEJ img {
        display: block;
        max-width: 100%;
        max-height: 520px;
        font-size: 0;
        margin: 0px auto;
        padding: 0px;
      } /*!sc*/
      .hpaLEJ video {
        display: block;
        margin: 1rem auto;
      } /*!sc*/
      .hpaLEJ figure {
        text-align: center;
        margin: 20px 0px;
      } /*!sc*/
      .hpaLEJ figure img {
        display: block;
        max-width: 90vw;
        margin: 0px auto;
      } /*!sc*/
      .hpaLEJ figure figcaption {
        opacity: 0.9;
        font-size: 1.1em;
        margin: 10px auto;
      } /*!sc*/
      .hpaLEJ .cali-collage {
        padding: 20px 0px;
        text-align: center;
      } /*!sc*/
      .hpaLEJ .cali-collage img {
        display: inline-block;
        margin: 10px;
        max-width: 95vw;
        vertical-align: middle;
        box-shadow: 0 0 5px rgba(0, 0, 0, 0.2);
      } /*!sc*/
      data-styled.g55[id='sc-bpuAaX'] {
        content: 'hpaLEJ,';
      } /*!sc*/
      .gPIOea {
        text-align: center;
      } /*!sc*/
      @media (prefers-color-scheme: dark) {
        .gPIOea {
          color: #dbe0e7;
        }
      } /*!sc*/
      .gPIOea h3 {
        margin: 0.5em 0;
      } /*!sc*/
      .gPIOea p {
        margin: 0;
      } /*!sc*/
      data-styled.g56[id='sc-fPyrPm'] {
        content: 'gPIOea,';
      } /*!sc*/
    </style>

    <script
      async
      src="https://www.googletagmanager.com/gtag/js?id=G-G3SKTPFTEZ"
    ></script>
    <script>
      window.dataLayer = window.dataLayer || []
      function gtag() {
        dataLayer.push(arguments)
      }
      gtag('js', new Date())
      gtag('config', 'G-G3SKTPFTEZ')
    </script>
  </head>
  <body>
    <div class="sc-dKREkF debzsy">
      <div class="sc-fYsHOw hxbvAH">
        <div class="sc-dKREkF debzsy">
          <div class="sc-fWnslK dtgyPg">
            <nav class="sc-cUiCeM jjMGJZ">
              <h1><a href="/">Chris Andrejewski</a></h1>
            </nav>
          </div>
        </div>
        <div class="sc-fWnslK dtgyPg">
          <div class="sc-iQQCXo hkwuxz">
            <p class="sc-kpOvIu iwpgrf">
              <a href="/writing" class="sc-icnseD leFObR">Articles</a
              ><a href="/category/ruby/index.html" class="sc-icnseD leFObR"
                >Ruby programming</a
              ><a
                href="/category/engineering/index.html"
                class="sc-icnseD leFObR"
                >Engineering</a
              >
            </p>
            <h1 class="sc-gDpztx foDfFI">
              <a href="#" class="sc-jMsorb iLjxYJ"
                ><span>Making my first Ruby gem</span></a
              >
            </h1>
            <p class="sc-kpOvIu iwpgrf">
              An experience report of writing and publishing a Ruby gem
            </p>
          </div>
          <div class="sc-cXawGu hskrPk">
            <p class="sc-kpOvIu iwpgrf"><label>Table of contents</label></p>
            <div>
              <ul>
                <li><a href="#requirements">Requirements</a></li>
                <li><a href="#what-i-liked">What I liked</a></li>
                <li><a href="#where-i-deviated">Where I deviated</a></li>
                <li>
                  <a href="#friction-log">Friction log</a>
                  <ul>
                    <li><a href="#ruby-on-mac-pains">Ruby on Mac pains</a></li>
                    <li><a href="#rubygem-yanks">RubyGem yanks</a></li>
                    <li>
                      <a href="#minor-vscode-and-rubyfmt"
                        >Minor: VSCode and <code>rubyfmt</code></a
                      >
                    </li>
                  </ul>
                </li>
              </ul>
            </div>
          </div>
          <div class="sc-dIMoHT eyyqef">
            <div class="sc-bpuAaX hpaLEJ">
              <p>
                A couple nights ago I was overcome with the urge to publish a
                Ruby gem. I have been writing Ruby for over 5 years and realized
                that it was time to give Ruby development outside of Stripe's
                Ruby infra a shot.
              </p>
              <p>
                The package is
                <a href="https://github.com/andrejewski/eclair"
                  ><code>eclair</code></a
                >
                which I've wanted to build on and off for about three years now.
                It's worth its own article and context, so that's all I'll say
                about the gem itself here.
              </p>
              <h1 id="requirements">
                <a href="#requirements">Requirements</a>
              </h1>
              <p>
                I wanted to put a strong foot forward when publishing the gem. I
                do a lot of advocacy for writing high-quality Ruby code, mostly
                internal to Stripe, but also in public. Check out
                <a href="/ruby-style-guide">Ruby style guide</a> and
                <a href="/effective-sorbet">Effective Sorbet</a> for most of the
                advice.
              </p>
              <p>
                However, I haven't shared a whole Ruby library in public before.
                While I didn't expect to do a perfect job with the new stuff, I
                did want to get some things right.
              </p>
              <p>Requirements:</p>
              <ul>
                <li>
                  Sorbet types, <code>strict</code> typing as the minimum.
                </li>
                <li>Format code using <code>rubyfmt</code>.</li>
                <li>
                  Follow the Ruby style guide and Effective Sorbet articles.
                </li>
              </ul>
              <p>Plus the stuff I would do in any design:</p>
              <ul>
                <li>Provide a minimal API surface</li>
                <li>Favor composition over inheritance</li>
                <li>Make it hard to misuse by default</li>
              </ul>
              <h1 id="what-i-liked">
                <a href="#what-i-liked">What I liked</a>
              </h1>
              <ul>
                <li>
                  <p>
                    I learned much more about the Ruby language's built-in
                    tooling. It's cool to see <code>ruby</code>,
                    <code>irb</code>, <code>bundle</code>, and
                    <code>gem</code> all coming as a unit. Never really knew
                    they flocked together. Getting Ruby to a newer version got
                    all these things to a newer version too.
                  </p>
                </li>
                <li>
                  <p>
                    I'm a big fan of Clojure. In that ecosystem the mantra is
                    everything is data. You often write configuration files as
                    Clojure data structures. It was cool to see Ruby doing a
                    similar thing, even if it forgot the data part.
                    <code>Gemfile</code>, <code>Gemspec</code>,
                    <code>Rakefile</code> are all Ruby code. I've definitely
                    touched Stripe Gemfiles before but working with the RubyGem
                    registry made it so much clearer how everything was fitting
                    together.
                  </p>
                </li>
                <li>
                  <p>
                    The Sorbet VSCode extension can be slow at Stripe scale. On
                    a few hundred billion lines less of Ruby it was amazing.
                  </p>
                </li>
                <li>
                  <p>
                    The <code>minitest</code> style of tests were nice. Having
                    really only written RSpec-like tests,
                    <code>minitest</code> feels a lot less magical and much
                    smaller. Definitely reminded me of Go tests.
                  </p>
                </li>
              </ul>
              <h1 id="where-i-deviated">
                <a href="#where-i-deviated">Where I deviated</a>
              </h1>
              <p>
                I wanted to follow Effective Sorbet precisely but there was one
                thing that I could not do because I felt it was not appropriate
                for an open-source project.
              </p>
              <p>
                Despite recommending them heavily, I didn't use
                <code>T::Struct</code>. I had used
                <code>T::Struct</code> initially but switched to plain old Ruby
                objects (POROs).
              </p>
              <p>
                The reasoning: too many methods and too many
                <a
                  href="https://sorbet.org/docs/tstruct#serialize-and-from_hash-converting-tstruct-to-and-from-hash"
                  >bad methods</a
                >, e.g. <code>with</code>, <code>from_hash</code>, etc. I can't
                feel comfortable shipping a gem with that much baggage of
                unexpected behavior.
              </p>
              <h1 id="friction-log">
                <a href="#friction-log">Friction log</a>
              </h1>
              <p>
                Stripes write friction logs. A friction log is basically a
                stream of conscious document that details everything and
                anything that went wrong or felt off about doing something. As a
                platform team lead, I get friction logs from folks across the
                company all the time. Those logs feed into what we choose to
                prioritize. It's a good system.
              </p>
              <p>Here's a distillation of my frictions:</p>
              <h2 id="ruby-on-mac-pains">
                <a href="#ruby-on-mac-pains">Ruby on Mac pains</a>
              </h2>
              <p>
                By far I wasted the most time trying to get Ruby set up on my
                Macbook. Stripe-issued laptops solve this problem so I hadn't
                felt the pain before.
              </p>
              <p>
                Apple ships an old version of Ruby (~v2.6) but all the tooling I
                worked with expected Ruby 3.0. In retrospect, had I got the Ruby
                version issue fixed earlier in the process so many things would
                have been smoother.
              </p>
              <p>
                I felt this pain most when setting up Sorbet, in particular
                initializing my project with
                <a href="https://github.com/Shopify/tapioca">Tapioca</a>. The
                exception thrown running
                <code>bundle exec tapioca init</code> wasn't super helpful but
                luckily enough to search me up a
                <a href="https://github.com/Shopify/tapioca/issues/1592"
                  >lead on how to fix it</a
                >.
              </p>
              <p>
                Once I eventually got <code>rbenv</code> setup and working, and
                had rebooted everything to use it instead of the Mac-default
                Ruby version things got better.
              </p>
              <h2 id="rubygem-yanks">
                <a href="#rubygem-yanks">RubyGem yanks</a>
              </h2>
              <p>
                In terms of wall-clock time spent, RubyGems caused me the
                greatest time loss. RubyGems is great but the search page
                results were a bit all too easy to misread. When I started my
                gem-ing, the first thing I did was see if the name
                &quot;eclair&quot; was available. I got so excited because I saw
                it was.
              </p>
              <p>
                It was only after a long night of working on the gem itself that
                I finally went to publish my gem and it turned out
                <code>eclair</code> was not available. The gem had been recently
                &quot;yanked,&quot; meaning taken down by its author. The gem
                was unused but I wouldn't be able to claim it for 3 months.
              </p>
              <p>Betrayal, the worst of all.</p>
              <p>
                Luckily only a little more than a day later after reaching out
                to the current gem owner, they graciously transferred the gem
                over to me. Thanks again, Cyrus!
              </p>
              <h2 id="minor:-vscode-and">
                <a href="#minor:-vscode-and"
                  >Minor: VSCode and <code>rubyfmt</code></a
                >
              </h2>
              <p>
                The Ruby formatter <code>rubyfmt</code> doesn't seem to
                integrate with the
                <a
                  href="https://marketplace.visualstudio.com/items?itemName=Shopify.ruby-lsp"
                  >Ruby LSP extension</a
                >. It probably works with the old &quot;Ruby&quot; extension but
                VSCode steers people away from downloading that one.
              </p>
              <p>
                This isn't a big deal, I just didn't manage to get
                format-on-save working.
              </p>
              <p>
                Overall publishing a Ruby gem was a pleasant experience. I
                learned a good amount from it and it was nice learning how to
                set up Sorbet, <code>rubyfmt</code>, and other things I'd only
                previously used because someone else installed them for me.
                Thanks for reading!
              </p>
            </div>
          </div>
          <div class="sc-dIMoHT eyyqef">
            <p class="sc-kpOvIu iwpgrf">
              <small
                ><time
                  datetime="2023-10-25T00:00:00.000Z"
                  title="2023-10-25T00:00:00.000Z"
                  >Published 10/25/2023</time
                ></small
              >
            </p>
          </div>
          <div
            class="sc-gDVcuj gdJarr newsletter-container"
            data-frame-src="https://newsletter.jew.ski/frame/subscribe"
          >
            <div class="sc-fPyrPm gPIOea">
              <h3>Subscribe for new articles</h3>
              <div class="newsletter-form"></div>
              <p>
                <small
                  >Or add the
                  <a href="/writing/feed.atom.xml" class="sc-Qotzb bctNTf"
                    >Atom feed</a
                  >
                  to your feed reader.</small
                >
              </p>
            </div>
            <script src="https://newsletter-js.jew.ski/v1/subscribe-embed.js"></script>
          </div>
        </div>
      </div>
    </div>
  </body>
</html>
